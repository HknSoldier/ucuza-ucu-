name: TITAN V2.5 - Professional Flight Hacker

on:
  schedule:
    # Her gÃ¼n TÃ¼rkiye saati 02:00 (UTC 23:00 - Ã¶nceki gÃ¼n)
    - cron: '0 23 * * *'
    
    # VEYA sadece SalÄ±-Ã‡arÅŸamba (price update gÃ¼nleri)
    # - cron: '0 23 * * 1,2'  # Monday=1, Tuesday=2 (UTC)
  
  workflow_dispatch:  # Manuel Ã§alÄ±ÅŸtÄ±rma

jobs:
  hunt-flights:
    runs-on: ubuntu-latest
    timeout-minutes: 120  # 2 saat timeout
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
    
    - name: ğŸ Setup Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        cache: 'pip'
    
    - name: ğŸ“¦ Install Python Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: ğŸ­ Install Playwright Chromium
      run: |
        playwright install chromium
        playwright install-deps chromium
    
    - name: âœ… Verify Installation
      run: |
        echo "Python version:"
        python --version
        echo ""
        echo "Playwright version:"
        playwright --version
        echo ""
        echo "Installed packages:"
        pip list | grep -E "playwright|aiohttp|feedparser"
    
    - name: ğŸ¦… Run PROJECT TITAN V2.5
      run: |
        python main_v25.py
      env:
        PYTHONUNBUFFERED: 1
    
    - name: ğŸ“Š Upload Logs & State
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: titan-v25-logs-${{ github.run_number }}
        path: |
          titan_v25.log
          titan_state.json
          notification_state.json
          debug_*.png
        retention-days: 7
        if-no-files-found: warn
    
    - name: ğŸ“ˆ Display Performance Stats
      if: always()
      run: |
        echo "====== TITAN V2.5 PERFORMANCE STATS ======"
        if [ -f titan_v25.log ]; then
          echo ""
          echo "ğŸ“Š Key Metrics:"
          grep -E "Total Routes|Successful|Ultra Deals|Mistake Fares|Queued Alerts" titan_v25.log | tail -10
          echo ""
          echo "ğŸ“… Sweet Spot Window:"
          grep -E "SWEET SPOT WINDOW" titan_v25.log | tail -3
          echo ""
          echo "Last 15 log lines:"
          tail -n 15 titan_v25.log
        else
          echo "âš ï¸ Log file not found"
        fi
        echo "========================================="
